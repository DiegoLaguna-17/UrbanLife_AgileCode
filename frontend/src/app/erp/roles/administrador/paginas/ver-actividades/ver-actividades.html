<div class="main-container">
  <div class="actividades-container">
    <!-- Bot√≥n Volver -->
    <button class="btn-volver" (click)="volver()">‚Üê Volver</button>

    <h1 class="titulo-principal">Actividades del Proyecto</h1>
    
    <!-- Informaci√≥n del proyecto -->
    <div class="proyecto-info">
      <h2 class="nombre-proyecto">{{ proyecto?.nombre }}</h2>
      <p class="descripcion-proyecto">{{ proyecto?.descripcion }}</p>
      <div class="proyecto-estado">
        <span class="estado-badge" [class]="getEstadoClass()">{{ proyecto?.estado }}</span>
        <span class="fechas-proyecto">üìÖ {{ proyecto?.fecha_inicio }} - {{ proyecto?.fecha_fin }}</span>
      </div>
    </div>

    <!-- Bot√≥n para a√±adir actividad -->
    <div class="add-activity-section">
      <div class="activity-stats">
        <div class="stat-item">
          <span class="stat-label">Total:</span>
          <span class="stat-value">{{ contarActividadesTotales() }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Completadas:</span>
          <span class="stat-value completadas">{{ contarPorEstado('Completada') }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">En Progreso:</span>
          <span class="stat-value en-progreso">{{ contarPorEstado('En progreso') }}</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Pendientes:</span>
          <span class="stat-value pendientes">{{ contarPorEstado('Pendiente') }}</span>
        </div>
      </div>
    </div>

    <!-- Filtros de actividades -->
    <div class="filters-section">
      <div class="filter-group">
        <label class="filter-label">Filtrar por estado:</label>
        <div class="filter-buttons">
          <button class="filter-btn" 
                  [class.active]="filtroEstado === 'todas'"
                  (click)="cambiarFiltro('todas')">
            Todas ({{ contarActividadesTotales() }})
          </button>
          <button class="filter-btn" 
                  [class.active]="filtroEstado === 'Completada'"
                  (click)="cambiarFiltro('Completada')">
            Completadas ({{ contarPorEstado('Completada') }})
          </button>
          <button class="filter-btn" 
                  [class.active]="filtroEstado === 'En progreso'"
                  (click)="cambiarFiltro('En progreso')">
            En Progreso ({{ contarPorEstado('En progreso') }})
          </button>
          <button class="filter-btn" 
                  [class.active]="filtroEstado === 'Pendiente'"
                  (click)="cambiarFiltro('Pendiente')">
            Pendientes ({{ contarPorEstado('Pendiente') }})
          </button>
        </div>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">Ordenar por:</label>
        <div class="filter-buttons">
          <button class="filter-btn" 
                  [class.active]="ordenPor === 'fecha'"
                  (click)="cambiarOrden('fecha')">
            Fecha
          </button>
          <button class="filter-btn" 
                  [class.active]="ordenPor === 'estado'"
                  (click)="cambiarOrden('estado')">
            Estado
          </button>
          <button class="filter-btn" 
                  [class.active]="ordenPor === 'nombre'"
                  (click)="cambiarOrden('nombre')">
            Nombre
          </button>
        </div>
      </div>
    </div>

    <!-- Lista de actividades -->
    <div class="actividades-list">
      <!-- Actividades Completadas -->
      <div class="activities-category" *ngIf="actividadesFiltradasPorEstado('Completada').length > 0">
        <div class="category-header completed">
          <h2 class="category-title">‚úÖ COMPLETADAS</h2>
          <span class="activities-count">{{ actividadesFiltradasPorEstado('Completada').length }} actividades</span>
        </div>
        <div class="activities-grid">
          <div class="activity-card completed" *ngFor="let actividad of actividadesFiltradasPorEstado('Completada')">
            <div class="activity-icon">‚úÖ</div>
            <div class="activity-content">
              <div class="activity-header">
                <h3 class="activity-name">{{ actividad.nombre_actividad }}</h3>
                <span class="activity-date">{{ actividad.fecha | date:'dd/MM/yyyy' }}</span>
              </div>
              <p class="activity-desc">{{ actividad.descripcion }}</p>
              <div class="activity-footer">
                <span class="activity-status completed">COMPLETADA</span>
                <div class="activity-actions">
                  <button class="btn-action btn-edit" (click)="editarActividad(actividad)">Editar</button>
                  <button class="btn-action btn-view" (click)="verActividad(actividad)">Ver Detalles</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actividades En Progreso -->
      <div class="activities-category" *ngIf="actividadesFiltradasPorEstado('En progreso').length > 0">
        <div class="category-header in-progress">
          <h2 class="category-title">üîÑ EN PROGRESO</h2>
          <span class="activities-count">{{ actividadesFiltradasPorEstado('En progreso').length }} actividades</span>
        </div>
        <div class="activities-grid">
          <div class="activity-card in-progress" *ngFor="let actividad of actividadesFiltradasPorEstado('En progreso')">
            <div class="activity-icon">üîÑ</div>
            <div class="activity-content">
              <div class="activity-header">
                <h3 class="activity-name">{{ actividad.nombre_actividad }}</h3>
                <span class="activity-date">{{ actividad.fecha | date:'dd/MM/yyyy' }}</span>
              </div>
              <p class="activity-desc">{{ actividad.descripcion }}</p>
              <div class="activity-footer">
                <span class="activity-status in-progress">EN PROGRESO</span>
                <div class="activity-actions">
                  <button class="btn-action btn-complete" (click)="completarActividad(actividad)">Marcar como Completada</button>
                  <button class="btn-action btn-edit" (click)="editarActividad(actividad)">Editar</button>
                  <button class="btn-action btn-view" (click)="verActividad(actividad)">Ver Detalles</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Actividades Pendientes -->
      <div class="activities-category" *ngIf="actividadesFiltradasPorEstado('Pendiente').length > 0">
        <div class="category-header pending">
          <h2 class="category-title">‚è≥ PENDIENTES</h2>
          <span class="activities-count">{{ actividadesFiltradasPorEstado('Pendiente').length }} actividades</span>
        </div>
        <div class="activities-grid">
          <div class="activity-card pending" *ngFor="let actividad of actividadesFiltradasPorEstado('Pendiente')">
            <div class="activity-icon">‚è≥</div>
            <div class="activity-content">
              <div class="activity-header">
                <h3 class="activity-name">{{ actividad.nombre_actividad }}</h3>
                <span class="activity-date">{{ actividad.fecha | date:'dd/MM/yyyy' }}</span>
              </div>
              <p class="activity-desc">{{ actividad.descripcion }}</p>
              <div class="activity-footer">
                <span class="activity-status pending">PENDIENTE</span>
                <div class="activity-actions">
                  <button class="btn-action btn-start" (click)="iniciarActividad(actividad)">Iniciar Actividad</button>
                  <button class="btn-action btn-edit" (click)="editarActividad(actividad)">Editar</button>
                  <button class="btn-action btn-view" (click)="verActividad(actividad)">Ver Detalles</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Mensaje si no hay actividades -->
      <div class="no-activities" *ngIf="actividadesFiltradas().length === 0">
        <div class="no-activities-icon">üìã</div>
        <h3>No hay actividades registradas</h3>
        <p *ngIf="filtroEstado === 'todas'">
          Presiona "A√±adir Actividad" para comenzar a registrar las actividades del proyecto.
        </p>
        <p *ngIf="filtroEstado !== 'todas'">
          No hay actividades con el estado "{{ filtroEstado }}".
        </p>
      </div>
    </div>

    <!-- Resumen y progreso -->
    <div class="progress-summary">
      <h3>Progreso General del Proyecto</h3>
      <div class="progress-bar-container">
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="calcularProgresoGeneral()"></div>
        </div>
        <div class="progress-text">{{ calcularProgresoGeneral() }}% completado</div>
      </div>
      
      <div class="summary-details">
        <div class="detail-item">
          <span class="detail-label">Actividades Completadas:</span>
          <span class="detail-value">{{ contarPorEstado('Completada') }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Actividades en Progreso:</span>
          <span class="detail-value">{{ contarPorEstado('En progreso') }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Actividades Pendientes:</span>
          <span class="detail-value">{{ contarPorEstado('Pendiente') }}</span>
        </div>
        <div class="detail-item total">
          <span class="detail-label">Total de Actividades:</span>
          <span class="detail-value">{{ contarActividadesTotales() }}</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal para ver actividad -->
<div class="modal-overlay" *ngIf="mostrarModalVer">
  <div class="modal">
    <div class="modal-content">
      <div class="modal-icon">{{ getActividadIcon(actividadSeleccionada) }}</div>
      <h3 class="modal-title">{{ actividadSeleccionada?.nombre_actividad }}</h3>
      
      <div class="activity-details-modal">
        <div class="detail-item">
          <strong>Descripci√≥n:</strong>
          <p>{{ actividadSeleccionada?.descripcion }}</p>
        </div>
        <div class="detail-row">
          <div class="detail-item">
            <strong>Fecha:</strong>
            <span>{{ actividadSeleccionada?.fecha | date:'dd/MM/yyyy' }}</span>
          </div>
          <div class="detail-item">
            <strong>Estado:</strong>
            <span [class]="'status-' + actividadSeleccionada?.estado?.toLowerCase()">
              {{ actividadSeleccionada?.estado }}
            </span>
          </div>
        </div>
        <div class="detail-item">
          <strong>Proyecto:</strong>
          <span>{{ proyecto?.nombre }}</span>
        </div>
      </div>
      
      <div class="modal-actions">
        <button class="btn-modal btn-edit" (click)="editarActividad(actividadSeleccionada!)">
          Editar
        </button>
        <button class="btn-modal btn-close" (click)="cerrarModalVer()">
          Cerrar
        </button>
      </div>
    </div>
  </div>
</div>