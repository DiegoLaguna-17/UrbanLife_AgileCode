<div class="main-container">
  <div class="recibir-container">
    <!-- Botón Volver -->
    <button class="btn-volver" (click)="volver()">← Volver</button>

    <h1 class="titulo-principal">Recepción del Pedido</h1>

    <!-- Información del pedido -->
    <div class="pedido-info-section">
      <div class="pedido-info">
        <div class="info-row">
          <strong class="detalle">Proveedor:</strong>
          <span class="info">{{ pedido?.nombre_proveedor }}</span>
        </div>
        <div class="info-row">
          <strong class="detalle">Costo Total:</strong>
          <span class="info">Bs. {{ pedido?.monto?.toFixed(2) }}</span>
        </div>
        <div class="info-row">
          <strong class="detalle">Fecha de Solicitud:</strong>
          <span class="info">{{ pedido?.fecha_solicitud }}</span>
        </div>
      </div>
    </div>

    <!-- Tabla de materiales -->
    <div class="tabla-section">
      <h2 class="section-title">Detalle del Pedido</h2>
      <div class="table-container">
        <table class="materiales-table">
          <thead>
            <tr>
              <th>Material</th>
              <th>Cantidad Solicitada</th>
              <th>Cantidad Recibida</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let material of materialesConRecepcion; let i = index">
              <td>{{ material.material }}</td>
              <td>{{ material.cantidad }}</td>
              <td>
                <input 
                  type="number" 
                  class="cantidad-input"
                  [min]="0"
                  [max]="material.cantidad"
                  [(ngModel)]="material.cantidadRecibida"
                  (change)="validarCantidad(material)"
                  placeholder="0"
                >
                <div class="error-message" *ngIf="material.error">
                  {{ material.error }}
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Botón registrar -->
    <div class="actions-section">
      <button 
        class="btn-registrar" 
        (click)="prepararConfirmacion()"
        [disabled]="!esFormularioValido()"
      >
        REGISTRAR LA ENTREGA
      </button>
    </div>
  </div>
</div>

<!-- Modal de confirmación -->
<div class="modal-overlay" *ngIf="mostrarModalConfirmacion">
  <div class="modal modal-confirmacion">
    <div class="modal-content">
      <h3 class="modal-title">Se registrará la entrega de:</h3>
      <div class="tabla-resumen">
        <table>
          <thead>
            <tr>
              <th>Material</th>
              <th>Solicitado</th>
              <th>Recibido</th>
              <th>Diferencia</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let material of materialesConRecepcion">
              <td>{{ material.material }}</td>
              <td>{{ material.cantidad }}</td>
              <td>{{ material.cantidadRecibida || 0 }}</td>
              <td [class.diferencia-negativa]="(material.cantidadRecibida || 0) < material.cantidad">
                {{ (material.cantidadRecibida || 0) - material.cantidad }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="botones-confirmacion">
        <button class="btn-registrar" (click)="confirmarRecepcion()">
          Confirmar Entrega
        </button>
        <button class="btn-modal btn-cancelar" (click)="cerrarModalConfirmacion()">
          Cancelar
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de éxito -->
<div class="modal-overlay" *ngIf="mostrarModalExito">
  <div class="modal">
    <div class="modal-content">
      <div class="modal-icon">✔️</div>
      <h3 class="modal-title">Recepción Registrada con Éxito</h3>
      <button class="btn-registrar" (click)="cerrarModalExito()">Aceptar</button>
    </div>
  </div>
</div>

<!-- Modal de error -->
<div class="modal-overlay" *ngIf="mostrarModalError">
  <div class="modal">
    <div class="modal-content">
      <div class="modal-icon">⚠️</div>
      <h3 class="modal-title">Error</h3>
      <p class="modal-message">{{ error }}</p>
      <button class="btn-modal" (click)="cerrarModalError()">Entendido</button>
    </div>
  </div>
</div>