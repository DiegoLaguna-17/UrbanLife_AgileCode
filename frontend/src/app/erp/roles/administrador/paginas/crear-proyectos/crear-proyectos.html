<div class="main-container">
  <div class="registro-container">
    <!-- Contenedor izquierdo (30%) -->
    <div class="left-panel">
      <!-- Bot√≥n Volver-->
      <button class="btn-volver" (click)="volver()">‚Üê Volver</button>
      
      <img src="../../../../../../assets/img/logos/logo-proyecto.png" alt="logo UrbanLife" class="imagen">
    </div>

    <!-- Contenedor derecho (70%) -->
    <div class="right-panel">
      <div class="form-container">
        <h1 class="titulo-principal">Registro de Proyectos</h1>

        <form class="registro-form" [formGroup]="registroForm" (ngSubmit)="onSubmit()">
          
          <!-- PRIMERA PARTE: Informaci√≥n b√°sica del proyecto -->
          <div class="form-section" *ngIf="pasoActual === 1">
            <h2 class="section-title">Informaci√≥n del Proyecto</h2>
            
            <!-- Campo Nombre del Proyecto -->
            <div class="form-group">
              <label class="form-label">Nombre del Proyecto *</label>
              <input 
                type="text" 
                class="form-input"
                formControlName="nombreProyecto"
                placeholder="Ingrese el nombre del proyecto"
                maxlength="100"
              >
              <div class="char-counter">{{ nombreProyecto?.value?.length || 0 }}/100</div>
              <div class="error-message" *ngIf="nombreProyecto?.invalid && nombreProyecto?.touched">
                <span *ngIf="nombreProyecto?.errors?.['required']">El nombre del proyecto es requerido</span>
                <span *ngIf="nombreProyecto?.errors?.['minlength']">M√≠nimo 3 caracteres</span>
              </div>
            </div>

            <!-- Campo Descripci√≥n -->
            <div class="form-group">
              <label class="form-label">Descripci√≥n *</label>
              <textarea 
                class="form-textarea"
                formControlName="descripcion"
                placeholder="Describa el proyecto en detalle"
                rows="4"
                maxlength="500"
              ></textarea>
              <div class="char-counter">{{ descripcion?.value?.length || 0 }}/500</div>
              <div class="error-message" *ngIf="descripcion?.invalid && descripcion?.touched">
                <span *ngIf="descripcion?.errors?.['required']">La descripci√≥n es requerida</span>
                <span *ngIf="descripcion?.errors?.['minlength']">M√≠nimo 10 caracteres</span>
              </div>
            </div>

            <!-- Campos de Fechas -->
            <div class="fecha-container">
              <div class="form-group">
                <label class="form-label">Fecha de Inicio *</label>
                <input 
                  type="date" 
                  class="form-input"
                  formControlName="fechaInicio"
                >
                <div class="error-message" *ngIf="fechaInicio?.invalid && fechaInicio?.touched">
                  <span *ngIf="fechaInicio?.errors?.['required']">La fecha de inicio es requerida</span>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label">Fecha de Finalizaci√≥n *</label>
                <input 
                  type="date" 
                  class="form-input"
                  formControlName="fechaFinalizacion"
                >
                <div class="error-message" *ngIf="fechaFinalizacion?.invalid && fechaFinalizacion?.touched">
                  <span *ngIf="fechaFinalizacion?.errors?.['required']">La fecha de finalizaci√≥n es requerida</span>
                  <span *ngIf="fechaFinalizacion?.errors?.['fechaInvalida']">Debe ser posterior a la fecha de inicio</span>
                </div>
              </div>
            </div>

            <!-- Campo Departamento -->
            <div class="form-group">
              <label class="form-label">Departamento *</label>
              <select 
                class="form-input"
                formControlName="departamento"
              >
                <option value="">Seleccione un departamento</option>
                <option *ngFor="let depto of departamentos" [value]="depto">{{ depto }}</option>
              </select>
              <div class="error-message" *ngIf="departamento?.invalid && departamento?.touched">
                <span *ngIf="departamento?.errors?.['required']">El departamento es requerido</span>
              </div>
            </div>
          </div>

          <!-- SEGUNDA PARTE: Informaci√≥n financiera y documentaci√≥n -->
          <div class="form-section" *ngIf="pasoActual === 2">
            <h2 class="section-title">Finanzas y Documentaci√≥n</h2>
            
            <!-- Campo Presupuesto -->
            <div class="form-group">
              <label class="form-label">Presupuesto (Bs) *</label>
              <input 
                type="number" 
                class="form-input"
                formControlName="presupuesto"
                placeholder="0.00"
                (blur)="formatearPresupuesto($event)"
              >
              <div class="error-message" *ngIf="presupuesto?.invalid && presupuesto?.touched">
                <span *ngIf="presupuesto?.errors?.['required']">El presupuesto es requerido</span>
                <span *ngIf="presupuesto?.errors?.['min']">El valor debe ser positivo</span>
                <span *ngIf="presupuesto?.errors?.['pattern']">Ingrese un valor num√©rico v√°lido</span>
              </div>
            </div>

            <!-- Campo Jefe de Obra -->
            <div class="form-group">
              <label class="form-label">Jefe de Obra *</label>
              <select 
                class="form-input"
                formControlName="jefeObra"
              >
                <option value="">Seleccione un jefe de obra</option>
                <option *ngFor="let jefe of jefesObra" [value]="jefe.id_usuario">
                  {{ jefe.nombre_empleado }}
                </option>
              </select>
              <div class="error-message" *ngIf="jefeObra?.invalid && jefeObra?.touched">
                <span *ngIf="jefeObra?.errors?.['required']">El jefe de obra es requerido</span>
              </div>
            </div>

            <!-- Campo Contrato del Proyecto -->
            <div class="form-group">
              <label class="form-label">Contrato del Proyecto (PDF)</label>
              <div class="file-upload-container">
                <input 
                  type="file" 
                  class="file-input"
                  formControlName="contrato"
                  (change)="onFileSelected($event, 'contrato')"
                  accept=".pdf"
                  #contratoInput
                >
                <div class="file-upload-area" (click)="contratoInput.click()">
                  <span class="file-icon">üìÑ</span>
                  <span class="file-text" [class.has-file]="contratoArchivo">
                    {{ contratoArchivo ? contratoArchivo.name : 'Seleccione archivo PDF' }}
                  </span>
                  <button type="button" class="btn-browse">Examinar</button>
                </div>
              </div>
              <div class="file-hint">Formato aceptado: PDF (m√°x. 10MB)</div>
            </div>

            <!-- Campo Plano del Proyecto -->
            <div class="form-group">
              <label class="form-label">Plano del Proyecto</label>
              <div class="file-upload-container">
                <input 
                  type="file" 
                  class="file-input"
                  formControlName="plano"
                  (change)="onFileSelected($event, 'plano')"
                  accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.zip,.rar"
                  #planoInput
                >
                <div class="file-upload-area" (click)="planoInput.click()">
                  <span class="file-icon">üìê</span>
                  <span class="file-text" [class.has-file]="planoArchivo">
                    {{ planoArchivo ? planoArchivo.name : 'Seleccione plano del proyecto' }}
                  </span>
                  <button type="button" class="btn-browse">Examinar</button>
                </div>
              </div>
              <div class="file-hint">Formatos aceptados: PDF, DOC, JPG, PNG, ZIP, RAR (m√°x. 10MB)</div>
            </div>

            <!-- Campo Permisos Legales -->
            <div class="form-group">
              <label class="form-label">Permisos Legales (PDF)</label>
              <div class="file-upload-container">
                <input 
                  type="file" 
                  class="file-input"
                  formControlName="permisosLegales"
                  (change)="onFileSelected($event, 'permisos')"
                  accept=".pdf"
                  #permisosInput
                >
                <div class="file-upload-area" (click)="permisosInput.click()">
                  <span class="file-icon">‚öñÔ∏è</span>
                  <span class="file-text" [class.has-file]="permisosArchivo">
                    {{ permisosArchivo ? permisosArchivo.name : 'Seleccione permisos legales' }}
                  </span>
                  <button type="button" class="btn-browse">Examinar</button>
                </div>
              </div>
              <div class="file-hint">Formato aceptado: PDF (m√°x. 10MB)</div>
            </div>
          </div>

          <!-- Botones de navegaci√≥n -->
          <div class="botones-navegacion">
            <button 
              type="button" 
              class="btn-siguiente"
              *ngIf="pasoActual === 1"
              (click)="siguientePaso()"
              [disabled]="!esPaso1Valido()"
            >
              Siguiente ‚Üí
            </button>
            
            <button 
              type="button" 
              class="btn-anterior"
              *ngIf="pasoActual === 2"
              (click)="anteriorPaso()"
            >
              ‚Üê Anterior
            </button>
            
            <button 
              type="submit" 
              class="btn-registrar"
              *ngIf="pasoActual === 2"
              [disabled]="registroForm.invalid || loading"
            >
              <span *ngIf="!loading">REGISTRAR PROYECTO</span>
              <span *ngIf="loading">PROCESANDO...</span>
            </button>
          </div>
        </form>

        <!-- Barra de progreso -->
        <div class="progress-bar-container">
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="pasoActual === 1 ? 50 : 100"></div>
          </div>
          <div class="progress-text">
            Paso {{ pasoActual }} de 2 - {{ pasoActual === 1 ? '50%' : '100%' }} completado
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de √©xito -->
<div class="modal-overlay" *ngIf="mostrarModalExito">
  <div class="modal">
    <div class="modal-content">
      <div class="modal-icon">‚úîÔ∏è</div>
      <h3 class="modal-title">¬°Proyecto Registrado!</h3>
      <p class="modal-message">El proyecto ha sido registrado correctamente en el sistema.</p>
      <button class="btn-modal" (click)="cerrarModalExito()">Aceptar</button>
    </div>
  </div>
</div>

<!-- Modal de error -->
<div class="modal-overlay" *ngIf="mostrarModalError">
  <div class="modal">
    <div class="modal-content">
      <div class="modal-icon">‚ö†Ô∏è</div>
      <h3 class="modal-title">Error en el Formulario</h3>
      <p class="modal-message">Por favor, complete todos los campos obligatorios correctamente.</p>
      <button class="btn-modal" (click)="cerrarModalError()">Entendido</button>
    </div>
  </div>
</div>